"use strict";

Object.defineProperty(exports, "__esModule", {
  value: true
});
exports.mqttClientAsPromise = mqttClientAsPromise;

var _symbols = require("./symbols");

var _contants = require("./contants");

function toPromise(res, rej) {
  return (err, ...args) => {
    if (err) return rej(err);
    if (args.length) return res();
    if (args.length === 1) return res(args[0]);
    return res(args);
  };
}

function MqttClientAsPromise(mqttClient) {
  this[_symbols.asPromise] = true;
  this[_symbols.wrappedMqttClient] = mqttClient;

  for (const m of _contants.mappedMethods) this[m] = (...args) => mqttClient[m](...args);

  for (const m of _contants.mappedPromiseMethods) this[m] = (...args) => new Promise((res, rej) => mqttClient[m](...args, toPromise(res, rej)));
}

function mqttClientAsPromise(mqttClient) {
  if ((0, _symbols.alreadyWrapped)(mqttClient, _symbols.asPromise)) return mqttClient;
  return new MqttClientAsPromise(mqttClient);
}